import{j as e}from"./vendor-three-CQaKo-2P.js";import{r as y,R as M}from"./vendor-react-F9Y4d3HK.js";import{u as I}from"./index-D1Z6KemN.js";import{M as c,u as D,a as R,R as O,B as f,C as b,b as L}from"./vendor-flow-BwqUM98z.js";const S=[{id:"ui",type:"customNode",position:{x:400,y:0},data:{label:"UI / Simulator",icon:"ðŸ–¥ï¸",type:"UI_SIMULATOR"}},{id:"ws",type:"customNode",position:{x:400,y:100},data:{label:"WebSocket API",icon:"ðŸ”Œ",type:"WEBSOCKET_API"}},{id:"core",type:"customNode",position:{x:400,y:200},data:{label:"RobotCore",icon:"ðŸ¤–",type:"ROBOT_CORE"}},{id:"ik_mgr",type:"customNode",position:{x:200,y:300},data:{label:"IK Manager",icon:"ðŸŽ¯",type:"IK_MANAGER"}},{id:"motor_mgr",type:"customNode",position:{x:400,y:300},data:{label:"Motor Manager",icon:"âš™ï¸",type:"MOTOR_MANAGER"}},{id:"safety",type:"customNode",position:{x:600,y:300},data:{label:"Safety Manager",icon:"ðŸ›¡ï¸",type:"SAFETY_MANAGER"}},{id:"ik_solver",type:"customNode",position:{x:100,y:400},data:{label:"Active IK Solver",icon:"ðŸ“",type:"IK_SOLVER"}},{id:"servo_ctrl",type:"customNode",position:{x:300,y:400},data:{label:"Servo Controller",icon:"ðŸ”§",type:"SERVO_CONTROLLER"}},{id:"dc_ctrl",type:"customNode",position:{x:500,y:400},data:{label:"DC Controller",icon:"ðŸ”©",type:"DC_CONTROLLER"}},{id:"align",type:"customNode",position:{x:700,y:400},data:{label:"Alignment Checker",icon:"ðŸ“",type:"ALIGNMENT_CHECKER"}},{id:"encoders",type:"customNode",position:{x:500,y:500},data:{label:"Encoders",icon:"ðŸ“Š",type:"ENCODERS"}}],v=[{id:"e-ui-ws",source:"ui",target:"ws",type:"smoothstep",animated:!0,markerEnd:{type:c.ArrowClosed},data:{type:"COMMAND"}},{id:"e-ws-ui",source:"ws",target:"ui",type:"smoothstep",animated:!0,style:{stroke:"#4ecdc4"},data:{type:"FEEDBACK"}},{id:"e-ws-core",source:"ws",target:"core",type:"smoothstep",animated:!0,markerEnd:{type:c.ArrowClosed},data:{type:"COMMAND"}},{id:"e-core-ws",source:"core",target:"ws",type:"smoothstep",animated:!0,style:{stroke:"#4ecdc4"},data:{type:"FEEDBACK"}},{id:"e-core-ik",source:"core",target:"ik_mgr",type:"smoothstep",animated:!0,markerEnd:{type:c.ArrowClosed},data:{type:"COMMAND"}},{id:"e-ik-motor",source:"ik_mgr",target:"motor_mgr",type:"smoothstep",animated:!0,markerEnd:{type:c.ArrowClosed},data:{type:"COMMAND"}},{id:"e-ik-solver",source:"ik_mgr",target:"ik_solver",type:"smoothstep",animated:!0,data:{type:"COMMAND"}},{id:"e-solver-ik",source:"ik_solver",target:"ik_mgr",type:"smoothstep",style:{stroke:"#4ecdc4"},data:{type:"FEEDBACK"}},{id:"e-motor-servo",source:"motor_mgr",target:"servo_ctrl",type:"smoothstep",animated:!0,data:{type:"COMMAND"}},{id:"e-motor-dc",source:"motor_mgr",target:"dc_ctrl",type:"smoothstep",animated:!0,data:{type:"COMMAND"}},{id:"e-enc-align",source:"encoders",target:"align",type:"smoothstep",style:{stroke:"#4ecdc4"},data:{type:"FEEDBACK"}},{id:"e-motor-align",source:"motor_mgr",target:"align",type:"smoothstep",style:{stroke:"#f9c74f"},data:{type:"CONFIG"}},{id:"e-align-safety",source:"align",target:"safety",type:"smoothstep",style:{stroke:"#4ecdc4"},data:{type:"FEEDBACK"}},{id:"e-safety-motor",source:"safety",target:"motor_mgr",type:"smoothstep",style:{stroke:"#e63946",strokeDasharray:"5,5"},markerEnd:{type:c.ArrowClosed},data:{type:"SAFETY_GATE"}},{id:"e-safety-core",source:"safety",target:"core",type:"smoothstep",style:{stroke:"#e63946",strokeDasharray:"5,5"},markerEnd:{type:c.ArrowClosed},data:{type:"SAFETY_GATE"}}],j=({data:s,selected:d})=>{const i=s.status||"IDLE",r={IDLE:"#9e9e9e",ACTIVE:"#4caf50",WARNING:"#ff9800",FAULT:"#f44336",DISABLED:"#616161"};return e.jsxs("div",{className:`graph-node ${i.toLowerCase()} ${d?"selected":""}`,style:{borderColor:r[i]},children:[e.jsx("div",{className:"node-icon",children:s.icon}),e.jsx("div",{className:"node-label",children:s.label}),e.jsx("div",{className:"node-status",style:{backgroundColor:r[i]}}),s.value&&e.jsx("div",{className:"node-value",children:s.value})]})},w={customNode:j};function K(){const{isMoving:s,faultCode:d,aligned:i,motorType:r,activeIKSolver:E,connected:l,simulatorMode:u,alignmentCritical:A}=I(),m=y.useMemo(()=>S.map(a=>{let t="IDLE",o=null;switch(a.data.type){case"UI_SIMULATOR":t=l?"ACTIVE":"FAULT",o=u?"SIM":"HW";break;case"WEBSOCKET_API":t=l?"ACTIVE":"FAULT";break;case"ROBOT_CORE":t=s?"ACTIVE":"IDLE";break;case"IK_MANAGER":t="ACTIVE",o=E;break;case"MOTOR_MANAGER":t=s?"ACTIVE":"IDLE",o=r;break;case"SAFETY_MANAGER":t=d!==0?"FAULT":"ACTIVE";break;case"ALIGNMENT_CHECKER":t=A?"FAULT":i?"ACTIVE":"WARNING";break;case"SERVO_CONTROLLER":t=r==="SERVO"?"ACTIVE":"DISABLED";break;case"DC_CONTROLLER":t=r==="DC_ENCODER"?"ACTIVE":"DISABLED";break;default:t="IDLE"}return{...a,data:{...a.data,status:t,value:o}}}),[s,d,i,r,E,l,u,A]),p=y.useMemo(()=>v.map(a=>{var n,g;let t=((n=a.data)==null?void 0:n.type)==="COMMAND"&&s,o={...a.style};return d!==0&&((g=a.data)==null?void 0:g.type)==="SAFETY_GATE"&&(o.stroke="#f44336",o.strokeWidth=3,t=!0),{...a,animated:t,style:o}}),[s,d]),[k,N,T]=D(m),[_,C,h]=R(p);M.useEffect(()=>{N(m),C(p)},[m,p,N,C]);const x=y.useCallback((a,t)=>{I.getState().setSelectedNode(t.id)},[]);return e.jsxs("div",{className:"connections-graph",children:[e.jsxs(O,{nodes:k,edges:_,onNodesChange:T,onEdgesChange:h,onNodeClick:x,nodeTypes:w,fitView:!0,attributionPosition:"bottom-left",children:[e.jsx(f,{color:"#333",gap:16}),e.jsx(b,{}),e.jsx(L,{nodeColor:a=>{var n;const t=((n=a.data)==null?void 0:n.status)||"IDLE";return{IDLE:"#9e9e9e",ACTIVE:"#4caf50",WARNING:"#ff9800",FAULT:"#f44336",DISABLED:"#616161"}[t]}})]}),e.jsxs("div",{className:"graph-legend",children:[e.jsx("h4",{children:"Legend"}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"dot active"})," Active"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"dot warning"})," Warning"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"dot fault"})," Fault"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"dot disabled"})," Disabled"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"line command"})," Command"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"line feedback"})," Feedback"]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"line safety"})," Safety Gate"]})]})]})}export{K as default};
