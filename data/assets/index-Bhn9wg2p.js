const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RobotSimulator-DMJ7eLHF.js","assets/vendor-three-CQaKo-2P.js","assets/vendor-react-F9Y4d3HK.js","assets/ConnectionsGraph-DzDkyCeL.js","assets/vendor-flow-BwqUM98z.js","assets/ConnectionsGraph-B5DZHykP.css","assets/GeometryConfigPanel-DdIyWr1N.js","assets/MotionPanel-Dk-VOAFn.js","assets/DiagnosticsPanel-Lfnh815J.js"])))=>i.map(i=>d[i]);
import{a as V,j as i,_ as v,b as k}from"./vendor-three-CQaKo-2P.js";import{r as u,R as F}from"./vendor-react-F9Y4d3HK.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function e(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=e(a);fetch(a.href,l)}})();const b=V((t,n)=>({connected:!1,latencyMs:0,lastUpdateMs:0,simulatorMode:!0,hardwareArmed:!1,modeChangePending:!1,modeChangeError:null,mode:"MODE_1_OPEN_LOOP",isMoving:!1,isHomed:!1,motionAllowed:!0,faultCode:0,jointPositions:[0,0,0,0,0,0],jointVelocities:[0,0,0,0,0,0],jointTargets:[0,0,0,0,0,0],tcpPosition:[0,0,0],tcpOrientation:[0,0,0],motorType:"SERVO",activeFrame:"BASE",activeIKSolver:"NUMERICAL",ikPreference:"ACCURACY",lastIKResult:null,ikPreviewEnabled:!0,aligned:!0,alignmentWarning:!1,alignmentCritical:!1,speedModifier:1,maxJointError:0,tcpError:0,estopActive:!1,selectedJoint:0,jogSpeed:30,cartesianTarget:[300,0,250],showGhostRobot:!1,ghostJoints:[0,0,0,0,0,0],graphNodes:[],graphEdges:[],selectedNode:null,setConnected:e=>t({connected:e}),setLatency:e=>t({latencyMs:e}),requestModeChange:e=>{t({modeChangePending:!0,modeChangeError:null})},applyModeChange:e=>{e.success?t({simulatorMode:e.current_mode==="SIMULATOR",hardwareArmed:e.current_mode==="HARDWARE",modeChangePending:!1,modeChangeError:null}):t({modeChangePending:!1,modeChangeError:e.rejection_reason})},updateFromFirmware:e=>{var s,a,l,d,m;t({lastUpdateMs:Date.now(),mode:e.mode||n().mode,isMoving:e.is_moving??n().isMoving,isHomed:e.is_homed??n().isHomed,motionAllowed:e.motion_allowed??n().motionAllowed,faultCode:e.fault_code??n().faultCode,jointPositions:((s=e.joints)==null?void 0:s.positions_deg)||n().jointPositions,jointVelocities:((a=e.joints)==null?void 0:a.velocities_deg_s)||n().jointVelocities,jointTargets:((l=e.joints)==null?void 0:l.targets_deg)||n().jointTargets,tcpPosition:((d=e.tcp)==null?void 0:d.position_mm)||n().tcpPosition,tcpOrientation:((m=e.tcp)==null?void 0:m.orientation_deg)||n().tcpOrientation,motorType:e.motor_type||n().motorType,activeFrame:e.active_frame||n().activeFrame})},updateAlignment:e=>{t({aligned:e.aligned,alignmentWarning:e.warning,alignmentCritical:e.critical,speedModifier:e.speed_modifier,maxJointError:e.max_joint_error_deg,tcpError:e.tcp_error_mm})},updateSafety:e=>{t({faultCode:e.fault_code,estopActive:e.fault_name==="E_STOP_ACTIVE",motionAllowed:!e.motion_blocked})},setIKResult:e=>t({lastIKResult:e}),setIKSolver:e=>t({activeIKSolver:e}),setIKPreference:e=>t({ikPreference:e}),setGhostRobot:e=>t({showGhostRobot:!0,ghostJoints:e}),hideGhostRobot:()=>t({showGhostRobot:!1}),setSelectedJoint:e=>t({selectedJoint:e}),setJogSpeed:e=>t({jogSpeed:e}),setCartesianTarget:e=>t({cartesianTarget:e}),setActiveFrame:e=>t({activeFrame:e}),setGraphNodes:e=>t({graphNodes:e}),setGraphEdges:e=>t({graphEdges:e}),setSelectedNode:e=>t({selectedNode:e}),simulateJointMove:e=>{n().simulatorMode&&t({jointPositions:e})}})),o={jointPositions:[0,0,0,0,0,0],jointVelocities:[0,0,0,0,0,0],jointTargets:[0,0,0,0,0,0],isMoving:!1,motionProgress:0,motionStartTime:0,motionDuration:0,motionStartPositions:[0,0,0,0,0,0],faultCode:0,estopActive:!1,isHomed:!1,motionAllowed:!0,aligned:!0,alignmentWarning:!1,alignmentCritical:!1,maxJointError:0,speedModifier:1,motorType:"SERVO",operatingMode:"MODE_1_OPEN_LOOP"},M=[{min:-180,max:180,maxVel:120},{min:-90,max:90,maxVel:90},{min:-135,max:135,maxVel:100},{min:-180,max:180,maxVel:150},{min:-120,max:120,maxVel:120},{min:-180,max:180,maxVel:180}];let p={L1:150,L2:300,L3:250,L4:100};function J(t){p={...p,...t},console.log("[SIMULATED] DH params updated:",p)}function re(){return{...p}}let N=[...M];function le(t){N=t.map((n,e)=>({...M[e],...n})),console.log("[SIMULATED] Joint limits updated:",N)}function ce(){return N.map(t=>({...t}))}function U(t){const n=t.map(c=>c*Math.PI/180),e=Math.cos(n[0]),s=Math.sin(n[0]),a=Math.cos(n[1]),l=Math.sin(n[1]);Math.cos(n[2]),Math.sin(n[2]);const d=p.L2*a+p.L3*Math.cos(n[1]+n[2]),m=p.L1+p.L2*l+p.L3*Math.sin(n[1]+n[2]),f=d*e,r=d*s;return{position:[f,r,m],orientation:[t[3],t[4],t[5]]}}function T(t,n){const e=t[0],s=t[1],a=t[2],l=Math.atan2(s,e)*180/Math.PI,d=Math.sqrt(e*e+s*s),m=a-p.L1,f=Math.sqrt(d*d+m*m),r=p.L2,c=p.L3;if(f>r+c*.99||f<Math.abs(r-c)*1.01)return{feasible:!1,error_code:2,error_message:"Target unreachable"};let g=(f*f-r*r-c*c)/(2*r*c);g=Math.max(-1,Math.min(1,g));const h=Math.atan2(Math.sqrt(1-g*g),g)*180/Math.PI,j=Math.atan2(m,d),S=Math.atan2(c*Math.sin(h*Math.PI/180),r+c*Math.cos(h*Math.PI/180)),I=(j-S)*180/Math.PI,R=t[3]||0,D=t[4]||0,O=t[5]||0,A=[x(l),x(I),x(h),x(R),x(D),x(O)];for(let _=0;_<6;_++)if(A[_]<M[_].min||A[_]>M[_].max)return{feasible:!1,error_code:3,error_message:`Joint ${_} limit exceeded`,limiting_joint:_};const P=Math.abs(Math.sin(h*Math.PI/180));return{feasible:!0,joints_deg:A,velocities_deg_s:[30,40,35,20,25,30],confidence:P>.3?.9:.6,error_mm:.5,singularity_metric:P,singularity_warning:P<.15,joint_limit_warning:!1,limiting_joint:-1}}function x(t){for(;t>180;)t-=360;for(;t<-180;)t+=360;return t}function y(t,n=30){if(!o.motionAllowed||o.estopActive)return{success:!1,error:"Motion not allowed"};for(let s=0;s<6;s++)if(t[s]<M[s].min||t[s]>M[s].max)return{success:!1,error:`Joint ${s} limit exceeded`};let e=0;for(let s=0;s<6;s++){const a=Math.abs(t[s]-o.jointPositions[s]),l=Math.min(n,M[s].maxVel),d=a/l;d>e&&(e=d)}return o.motionStartPositions=[...o.jointPositions],o.jointTargets=[...t],o.motionStartTime=Date.now(),o.motionDuration=e*1e3,o.isMoving=!0,o.motionProgress=0,{success:!0,duration:e}}function G(){if(!o.isMoving)return;const t=Date.now()-o.motionStartTime,n=Math.min(1,t/o.motionDuration),e=(1-Math.cos(n*Math.PI))/2;for(let s=0;s<6;s++){const a=o.motionStartPositions[s],l=o.jointTargets[s];if(o.jointPositions[s]=a+(l-a)*e,o.motionDuration>0){const d=l-a,m=Math.sin(n*Math.PI);o.jointVelocities[s]=d/(o.motionDuration/1e3)*m*1.57}}o.motionProgress=n,n>=1&&(o.isMoving=!1,o.jointVelocities=[0,0,0,0,0,0])}function w(){o.isMoving=!1,o.jointTargets=[...o.jointPositions],o.jointVelocities=[0,0,0,0,0,0]}function H(){w(),o.faultCode=32,o.estopActive=!0,o.motionAllowed=!1}function K(){o.faultCode=0,o.estopActive=!1,o.motionAllowed=!0}function W(){let n=0;for(let e=0;e<6;e++){const s=(Math.random()-.5)*.3,a=Math.abs(s);a>n&&(n=a)}o.maxJointError=n,n>5?(o.alignmentCritical=!0,o.alignmentWarning=!0,o.aligned=!1,o.speedModifier=0):n>2?(o.alignmentCritical=!1,o.alignmentWarning=!0,o.aligned=!1,o.speedModifier=.5):(o.alignmentCritical=!1,o.alignmentWarning=!1,o.aligned=!0,o.speedModifier=1)}function $(){const t=U(o.jointPositions);return{version:1,timestamp_ms:Date.now(),type:"STATE_UPDATE",payload:{mode:o.operatingMode,is_moving:o.isMoving,is_homed:o.isHomed,motion_allowed:o.motionAllowed,fault_code:o.faultCode,joints:{positions_deg:[...o.jointPositions],velocities_deg_s:[...o.jointVelocities],targets_deg:[...o.jointTargets]},tcp:{position_mm:t.position,orientation_deg:t.orientation},motor_type:o.motorType,active_frame:"BASE"}}}function q(){return{version:1,timestamp_ms:Date.now(),type:"ALIGNMENT_STATUS",payload:{aligned:o.aligned,warning:o.alignmentWarning,critical:o.alignmentCritical,speed_modifier:o.speedModifier,max_joint_error_deg:o.maxJointError,worst_joint:0,tcp_error_mm:o.maxJointError*2,fault_code:o.alignmentCritical?64:0,fault_message:o.alignmentCritical?"Alignment critical":""}}}let C=!1;function L(){const t=u.useRef(null),n=u.useRef(null),e=b;u.useEffect(()=>{if(C)return;C=!0,e.getState().setConnected(!0),e.getState().setLatency(0),e.getState().applyModeChange({success:!0,current_mode:"SIMULATOR"});const r=()=>{G();const g=$();e.getState().updateFromFirmware(g.payload)},c=()=>{W();const g=q();e.getState().updateAlignment(g.payload)};return t.current=setInterval(r,100),n.current=setInterval(c,500),r(),c(),()=>{C=!1,clearInterval(t.current),clearInterval(n.current)}},[]);const s=u.useCallback((r,c,g)=>{const h=T(r);return e.getState().setIKResult(h),h},[]),a=u.useCallback(r=>{r?e.getState().applyModeChange({success:!0,current_mode:"SIMULATOR"}):e.getState().applyModeChange({success:!1,current_mode:"SIMULATOR",rejection_reason:"No hardware connected - simulation only mode",rejection_code:99})},[]),l=u.useCallback(r=>{if(r.type==="joint_move")return y(r.targets,r.velocity||30);if(r.type==="cartesian_move"){const c=T(r.target);return c.feasible?y(c.joints_deg,r.velocity||30):{success:!1,error:c.error_message}}else{if(r.type==="stop")return w(),{success:!0};if(r.type==="estop")return H(),e.getState().updateFromFirmware({fault_code:o.faultCode,motion_allowed:!1}),e.getState().updateSafety({fault_code:o.faultCode,fault_name:"E_STOP_ACTIVE",motion_blocked:!0}),{success:!0};if(r.type==="clear_fault")return K(),e.getState().updateFromFirmware({fault_code:0,motion_allowed:!0}),e.getState().updateSafety({fault_code:0,fault_name:"",motion_blocked:!1}),{success:!0}}return{success:!1,error:"Unknown command"}},[]),d=u.useCallback((r,c,g=30)=>{const h=o.jointPositions[r],j=[...o.jointPositions];j[r]=h+c*5;const S=M[r];return j[r]=Math.max(S.min,Math.min(S.max,j[r])),y(j,g)},[]),m=u.useCallback(r=>(J(r),{success:!0}),[]);return{send:u.useCallback((r,c)=>(console.log("[SIMULATED] Message:",r,c),!0),[]),requestIKPreview:s,requestModeSwitch:a,sendMotionCommand:l,jogJoint:d,setRobotGeometry:m,isSimulated:!0}}function z(){const{simulatorMode:t,hardwareArmed:n,modeChangePending:e,modeChangeError:s,isMoving:a,faultCode:l,estopActive:d}=b(),{requestModeSwitch:m}=L(),f=!a&&!e&&!d,r=()=>{f&&m(!t)};let c=null;return a&&(c="Motion in progress"),e&&(c="Switching..."),d&&(c="E-Stop active"),i.jsxs("div",{className:"simulator-toggle",children:[i.jsxs("div",{className:"toggle-container",children:[i.jsxs("button",{className:`mode-button hardware ${t?"":"active"}`,onClick:()=>t&&r(),disabled:!f||!t,children:[i.jsx("span",{className:"mode-icon",children:"âš™ï¸"}),i.jsx("span",{className:"mode-label",children:"HARDWARE"}),n&&!t&&i.jsx("span",{className:"armed-indicator",children:"ARMED"})]}),i.jsx("div",{className:`toggle-switch ${t?"simulator":"hardware"} ${f?"":"disabled"}`,onClick:r,role:"switch","aria-checked":t,children:i.jsx("div",{className:"toggle-thumb"})}),i.jsxs("button",{className:`mode-button simulator ${t?"active":""}`,onClick:()=>!t&&r(),disabled:!f||t,children:[i.jsx("span",{className:"mode-icon",children:"ðŸŽ®"}),i.jsx("span",{className:"mode-label",children:"SIMULATOR"})]})]}),i.jsxs("div",{className:"toggle-status",children:[e&&i.jsx("span",{className:"status-pending",children:"Switching mode..."}),s&&i.jsx("span",{className:"status-error",children:s}),c&&!e&&i.jsx("span",{className:"status-blocked",children:c})]}),!t&&i.jsx("div",{className:"hardware-warning",children:"âš ï¸ Commands will move real motors"})]})}const B=u.lazy(()=>v(()=>import("./RobotSimulator-DMJ7eLHF.js"),__vite__mapDeps([0,1,2]))),Y=u.lazy(()=>v(()=>import("./ConnectionsGraph-DzDkyCeL.js"),__vite__mapDeps([3,1,2,4,5]))),Q=u.lazy(()=>v(()=>import("./GeometryConfigPanel-DdIyWr1N.js"),__vite__mapDeps([6,1,2]))),X=[{id:"simulator",label:"3D Simulator",icon:"ðŸ¤–"},{id:"connections",label:"Connections",icon:"ðŸ”—"},{id:"motion",label:"Motion",icon:"ðŸŽ¯"},{id:"geometry",label:"Geometry",icon:"ðŸ“"},{id:"diagnostics",label:"Diagnostics",icon:"ðŸ“Š"}];function Z(){const[t,n]=u.useState("simulator"),{connected:e,simulatorMode:s,faultCode:a,aligned:l,estopActive:d}=b();return L(),i.jsxs("div",{className:"app-container",children:[i.jsxs("header",{className:"app-header",children:[i.jsxs("div",{className:"header-left",children:[i.jsx("h1",{className:"app-title",children:"ESP32 Robot Arm"}),i.jsx("span",{className:"app-subtitle",children:"Industrial Simulator"})]}),i.jsx("div",{className:"header-center",children:i.jsx(z,{})}),i.jsxs("div",{className:"header-right",children:[i.jsx(ee,{connected:e}),i.jsx(te,{estop:d,fault:a!==0,aligned:l})]})]}),i.jsx("nav",{className:"tab-navigation",children:X.map(m=>i.jsxs("button",{className:`tab-button ${t===m.id?"active":""}`,onClick:()=>n(m.id),children:[i.jsx("span",{className:"tab-icon",children:m.icon}),i.jsx("span",{className:"tab-label",children:m.label})]},m.id))}),i.jsx("main",{className:"main-content",children:i.jsxs(u.Suspense,{fallback:i.jsx(oe,{}),children:[t==="simulator"&&i.jsx(B,{}),t==="connections"&&i.jsx(Y,{}),t==="motion"&&i.jsx(ie,{}),t==="geometry"&&i.jsx(Q,{}),t==="diagnostics"&&i.jsx(ne,{})]})}),i.jsxs("footer",{className:"status-bar",children:[i.jsx(E,{label:"Mode",value:s?"SIMULATOR":"HARDWARE"}),i.jsx(E,{label:"Lat",value:`${b.getState().latencyMs}ms`}),i.jsx(E,{label:"Fault",value:`0x${a.toString(16).padStart(8,"0")}`})]})]})}function ee({connected:t}){return i.jsxs("div",{className:`connection-status ${t?"connected":"disconnected"}`,children:[i.jsx("span",{className:"status-dot"}),i.jsx("span",{className:"status-text",children:t?"Connected":"Disconnected"})]})}function te({estop:t,fault:n,aligned:e}){let s="ok",a="Safe";return t?(s="estop",a="E-STOP"):n?(s="fault",a="FAULT"):e||(s="warning",a="Misaligned"),i.jsxs("div",{className:`safety-indicator ${s}`,children:[i.jsx("span",{className:"safety-icon",children:"âš¡"}),i.jsx("span",{className:"safety-text",children:a})]})}function E({label:t,value:n}){return i.jsxs("div",{className:"status-item",children:[i.jsxs("span",{className:"status-label",children:[t,":"]}),i.jsx("span",{className:"status-value",children:n})]})}function oe(){return i.jsxs("div",{className:"loading-spinner",children:[i.jsx("div",{className:"spinner"}),i.jsx("span",{children:"Loading..."})]})}const ie=u.lazy(()=>v(()=>import("./MotionPanel-Dk-VOAFn.js"),__vite__mapDeps([7,1,2]))),ne=u.lazy(()=>v(()=>import("./DiagnosticsPanel-Lfnh815J.js"),__vite__mapDeps([8,1,2])));k.createRoot(document.getElementById("root")).render(i.jsx(F.StrictMode,{children:i.jsx(Z,{})}));export{M as J,ce as a,le as b,L as c,re as g,J as s,b as u};
