const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RobotSimulator-CFBZcFn0.js","assets/vendor-three-CQaKo-2P.js","assets/vendor-react-F9Y4d3HK.js","assets/ConnectionsGraph-Bnbv_AXI.js","assets/vendor-flow-BwqUM98z.js","assets/ConnectionsGraph-B5DZHykP.css"])))=>i.map(i=>d[i]);
import{a as y,j as o,_ as A,b as P}from"./vendor-three-CQaKo-2P.js";import{r as c,R as O}from"./vendor-react-F9Y4d3HK.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const h=y((t,s)=>({connected:!1,latencyMs:0,lastUpdateMs:0,simulatorMode:!1,hardwareArmed:!1,modeChangePending:!1,modeChangeError:null,mode:"MODE_1_OPEN_LOOP",isMoving:!1,isHomed:!1,motionAllowed:!0,faultCode:0,jointPositions:[0,0,0,0,0,0],jointVelocities:[0,0,0,0,0,0],jointTargets:[0,0,0,0,0,0],tcpPosition:[0,0,0],tcpOrientation:[0,0,0],motorType:"SERVO",activeFrame:"BASE",activeIKSolver:"NUMERICAL",ikPreference:"ACCURACY",lastIKResult:null,ikPreviewEnabled:!0,aligned:!0,alignmentWarning:!1,alignmentCritical:!1,speedModifier:1,maxJointError:0,tcpError:0,estopActive:!1,selectedJoint:0,jogSpeed:30,cartesianTarget:[300,0,250],showGhostRobot:!1,ghostJoints:[0,0,0,0,0,0],graphNodes:[],graphEdges:[],selectedNode:null,setConnected:e=>t({connected:e}),setLatency:e=>t({latencyMs:e}),requestModeChange:e=>{t({modeChangePending:!0,modeChangeError:null})},applyModeChange:e=>{e.success?t({simulatorMode:e.current_mode==="SIMULATOR",hardwareArmed:e.current_mode==="HARDWARE",modeChangePending:!1,modeChangeError:null}):t({modeChangePending:!1,modeChangeError:e.rejection_reason})},updateFromFirmware:e=>{var r,n,i,l,d;t({lastUpdateMs:Date.now(),mode:e.mode||s().mode,isMoving:e.is_moving??s().isMoving,isHomed:e.is_homed??s().isHomed,motionAllowed:e.motion_allowed??s().motionAllowed,faultCode:e.fault_code??s().faultCode,jointPositions:((r=e.joints)==null?void 0:r.positions_deg)||s().jointPositions,jointVelocities:((n=e.joints)==null?void 0:n.velocities_deg_s)||s().jointVelocities,jointTargets:((i=e.joints)==null?void 0:i.targets_deg)||s().jointTargets,tcpPosition:((l=e.tcp)==null?void 0:l.position_mm)||s().tcpPosition,tcpOrientation:((d=e.tcp)==null?void 0:d.orientation_deg)||s().tcpOrientation,motorType:e.motor_type||s().motorType,activeFrame:e.active_frame||s().activeFrame})},updateAlignment:e=>{t({aligned:e.aligned,alignmentWarning:e.warning,alignmentCritical:e.critical,speedModifier:e.speed_modifier,maxJointError:e.max_joint_error_deg,tcpError:e.tcp_error_mm})},updateSafety:e=>{t({faultCode:e.fault_code,estopActive:e.fault_name==="E_STOP_ACTIVE",motionAllowed:!e.motion_blocked})},setIKResult:e=>t({lastIKResult:e}),setIKSolver:e=>t({activeIKSolver:e}),setIKPreference:e=>t({ikPreference:e}),setGhostRobot:e=>t({showGhostRobot:!0,ghostJoints:e}),hideGhostRobot:()=>t({showGhostRobot:!1}),setSelectedJoint:e=>t({selectedJoint:e}),setJogSpeed:e=>t({jogSpeed:e}),setCartesianTarget:e=>t({cartesianTarget:e}),setActiveFrame:e=>t({activeFrame:e}),setGraphNodes:e=>t({graphNodes:e}),setGraphEdges:e=>t({graphEdges:e}),setSelectedNode:e=>t({selectedNode:e}),simulateJointMove:e=>{s().simulatorMode&&t({jointPositions:e})}})),C=500,I=1e4,k=500;function M(t=null){const s=c.useRef(null),e=c.useRef(null),r=c.useRef(null),n=c.useRef(C),{setConnected:i,setLatency:l,updateFromFirmware:d,updateAlignment:p,updateSafety:g,setIKResult:u,applyModeChange:S,requestModeChange:x}=h(),E=t||`ws://${window.location.host}/ws`,b=c.useCallback(m=>{try{const a=JSON.parse(m.data);if(a.version!==1){console.warn("Unknown message version:",a.version);return}switch(a.timestamp_ms&&l(Date.now()-a.timestamp_ms),a.type){case"STATE_UPDATE":d(a.payload);break;case"ALIGNMENT_STATUS":p(a.payload);break;case"SAFETY_FAULT":g(a.payload);break;case"IK_PREVIEW_RESULT":u(a.payload);break;case"IK_FAILURE":u({feasible:!1,error_code:a.payload.error_code,error_message:a.payload.error_message});break;case"MODE_CHANGE_RESPONSE":S(a.payload);break;case"MODE_STATUS":S({success:!0,current_mode:a.payload.mode});break;default:console.log("Unknown message type:",a.type)}}catch(a){console.error("WebSocket message parse error:",a)}},[d,p,g,u,S,l]),_=c.useCallback(()=>{var m;if(((m=s.current)==null?void 0:m.readyState)!==WebSocket.OPEN)try{s.current=new WebSocket(E),s.current.onopen=()=>{console.log("[WS] Connected"),i(!0),n.current=C,r.current&&(clearTimeout(r.current),r.current=null)},s.current.onclose=()=>{console.log("[WS] Disconnected"),r.current||(r.current=setTimeout(()=>{i(!1),x(!0),console.warn("[WS] Grace period expired - entering safe mode")},k)),e.current=setTimeout(()=>{n.current=Math.min(n.current*2,I),_()},n.current)},s.current.onerror=a=>{console.error("[WS] Error:",a)},s.current.onmessage=b}catch(a){console.error("[WS] Connection failed:",a)}},[E,i,b,x]),f=c.useCallback((m,a)=>{var v;if(((v=s.current)==null?void 0:v.readyState)!==WebSocket.OPEN)return console.warn("[WS] Cannot send - not connected"),!1;const j={version:1,timestamp_ms:Date.now(),type:m,payload:a};return s.current.send(JSON.stringify(j)),!0},[]),R=c.useCallback((m,a,j)=>f("IK_PREVIEW_REQUEST",{target_mm:m.slice(0,3),orientation_deg:m.slice(3,6),seed_joints_deg:a,solver:j}),[f]),T=c.useCallback(m=>f("MODE_CHANGE_REQUEST",{target_mode:m?"SIMULATOR":"HARDWARE",force:!1}),[f]),w=c.useCallback(m=>h.getState().simulatorMode?(console.warn("[WS] Motion command blocked - simulator mode"),!1):f("MOTION_COMMAND",m),[f]);return c.useEffect(()=>(_(),()=>{e.current&&clearTimeout(e.current),r.current&&clearTimeout(r.current),s.current&&s.current.close()}),[_]),{send:f,requestIKPreview:R,requestModeSwitch:T,sendMotionCommand:w}}function D(){const{simulatorMode:t,hardwareArmed:s,modeChangePending:e,modeChangeError:r,isMoving:n,faultCode:i,estopActive:l}=h(),{requestModeSwitch:d}=M(),p=!n&&!e&&!l,g=()=>{p&&(d(!t),h.getState().requestModeChange(!t))};let u=null;return n&&(u="Motion in progress"),e&&(u="Switching..."),l&&(u="E-Stop active"),o.jsxs("div",{className:"simulator-toggle",children:[o.jsxs("div",{className:"toggle-container",children:[o.jsxs("button",{className:`mode-button hardware ${t?"":"active"}`,onClick:()=>t&&g(),disabled:!p||!t,children:[o.jsx("span",{className:"mode-icon",children:"âš™ï¸"}),o.jsx("span",{className:"mode-label",children:"HARDWARE"}),s&&!t&&o.jsx("span",{className:"armed-indicator",children:"ARMED"})]}),o.jsx("div",{className:`toggle-switch ${t?"simulator":"hardware"} ${p?"":"disabled"}`,onClick:g,role:"switch","aria-checked":t,children:o.jsx("div",{className:"toggle-thumb"})}),o.jsxs("button",{className:`mode-button simulator ${t?"active":""}`,onClick:()=>!t&&g(),disabled:!p||t,children:[o.jsx("span",{className:"mode-icon",children:"ðŸŽ®"}),o.jsx("span",{className:"mode-label",children:"SIMULATOR"})]})]}),o.jsxs("div",{className:"toggle-status",children:[e&&o.jsx("span",{className:"status-pending",children:"Switching mode..."}),r&&o.jsx("span",{className:"status-error",children:r}),u&&!e&&o.jsx("span",{className:"status-blocked",children:u})]}),!t&&o.jsx("div",{className:"hardware-warning",children:"âš ï¸ Commands will move real motors"})]})}const L=c.lazy(()=>A(()=>import("./RobotSimulator-CFBZcFn0.js"),__vite__mapDeps([0,1,2]))),W=c.lazy(()=>A(()=>import("./ConnectionsGraph-Bnbv_AXI.js"),__vite__mapDeps([3,1,2,4,5]))),U=[{id:"simulator",label:"3D Simulator",icon:"ðŸ¤–"},{id:"connections",label:"Connections",icon:"ðŸ”—"},{id:"motion",label:"Motion",icon:"ðŸŽ¯"},{id:"diagnostics",label:"Diagnostics",icon:"ðŸ“Š"}];function F(){const[t,s]=c.useState("simulator"),{connected:e,simulatorMode:r,faultCode:n,aligned:i,estopActive:l}=h();return M(),o.jsxs("div",{className:"app-container",children:[o.jsxs("header",{className:"app-header",children:[o.jsxs("div",{className:"header-left",children:[o.jsx("h1",{className:"app-title",children:"ESP32 Robot Arm"}),o.jsx("span",{className:"app-subtitle",children:"Industrial Simulator"})]}),o.jsx("div",{className:"header-center",children:o.jsx(D,{})}),o.jsxs("div",{className:"header-right",children:[o.jsx(G,{connected:e}),o.jsx(K,{estop:l,fault:n!==0,aligned:i})]})]}),o.jsx("nav",{className:"tab-navigation",children:U.map(d=>o.jsxs("button",{className:`tab-button ${t===d.id?"active":""}`,onClick:()=>s(d.id),children:[o.jsx("span",{className:"tab-icon",children:d.icon}),o.jsx("span",{className:"tab-label",children:d.label})]},d.id))}),o.jsx("main",{className:"main-content",children:o.jsxs(c.Suspense,{fallback:o.jsx(J,{}),children:[t==="simulator"&&o.jsx(L,{}),t==="connections"&&o.jsx(W,{}),t==="motion"&&o.jsx($,{}),t==="diagnostics"&&o.jsx(H,{})]})}),o.jsxs("footer",{className:"status-bar",children:[o.jsx(N,{label:"Mode",value:r?"SIMULATOR":"HARDWARE"}),o.jsx(N,{label:"Lat",value:`${h.getState().latencyMs}ms`}),o.jsx(N,{label:"Fault",value:`0x${n.toString(16).padStart(8,"0")}`})]})]})}function G({connected:t}){return o.jsxs("div",{className:`connection-status ${t?"connected":"disconnected"}`,children:[o.jsx("span",{className:"status-dot"}),o.jsx("span",{className:"status-text",children:t?"Connected":"Disconnected"})]})}function K({estop:t,fault:s,aligned:e}){let r="ok",n="Safe";return t?(r="estop",n="E-STOP"):s?(r="fault",n="FAULT"):e||(r="warning",n="Misaligned"),o.jsxs("div",{className:`safety-indicator ${r}`,children:[o.jsx("span",{className:"safety-icon",children:"âš¡"}),o.jsx("span",{className:"safety-text",children:n})]})}function N({label:t,value:s}){return o.jsxs("div",{className:"status-item",children:[o.jsxs("span",{className:"status-label",children:[t,":"]}),o.jsx("span",{className:"status-value",children:s})]})}function J(){return o.jsxs("div",{className:"loading-spinner",children:[o.jsx("div",{className:"spinner"}),o.jsx("span",{children:"Loading..."})]})}function $(){return o.jsx("div",{className:"panel motion-panel",children:"Motion Control Panel"})}function H(){return o.jsx("div",{className:"panel diagnostics-panel",children:"Diagnostics Panel"})}P.createRoot(document.getElementById("root")).render(o.jsx(O.StrictMode,{children:o.jsx(F,{})}));export{h as u};
